{% extends "ETA/base.html" %}
{% block title %}{{ event.title }}{% endblock title %}

{% block content %}
<div class="container mt-4">

    <!-- Title & Host -->
    <div class="d-flex justify-content-between align-items-center">
        <h1>{{ event.title }}</h1>
        {% if event.host %}
            <small>Hosted by: {{ event.host.username }}</small>
        {% endif %}
    </div>

    <!-- Optional Event Image -->
    {% if event.image %}
      <img src="{{ event.image.url }}" alt="Event Image" class="img-fluid mb-3" style="max-width:600px;">
    {% else %}
  
      <!-- Show a default image or nothing -->
      <img src="https://via.placeholder.com/600x300?text=No+Image" alt="No Image Available" class="img-fluid mb-3">
    {% endif %}

    <!-- Description -->
    <p>{{ event.description }}</p>

    <!-- Date & Time Display -->
    <p>
      {% if event.start_date|date:"Y-m-d" == event.end_date|date:"Y-m-d" %}
        <strong>Time:</strong> 
        {{ event.start_date|date:"d M" }} {{ event.start_date|date:"H:i" }} - {{ event.end_date|date:"H:i" }}
      {% else %}
        <strong>Time:</strong> 
        {{ event.start_date|date:"d M H:i" }} - {{ event.end_date|date:"d M H:i" }}
      {% endif %}
    </p>

    <!-- Public/Private -->
    <p>
      {% if event.is_public %}
        <span class="badge badge-success">Public</span>
      {% else %}
        <span class="badge badge-secondary">Private</span>
      {% endif %}
    </p>

     <!-- Attendance badge -->
    {% if event.host == request.user %}
    <span class="badge badge-primary">Host</span>
    {% elif attendance %}
    {% if attendance.status == "going" %}
         <span class="badge badge-success">Going</span>
    {% elif attendance.status == "can_go" %}
         <span class="badge badge-warning">Can Go</span>
    {% elif attendance.status == "not_going" %}
         <span class="badge badge-danger">Not Going</span>
    {% endif %}
{% else %}
    <span class="badge badge-secondary">No Response</span>
{% endif %}


<br>
<br>
<!-- Going Button -->
<form method="post" action="{% url 'update_attendance' %}" style="display:inline;">
    {% csrf_token %}
    <input type="hidden" name="event_id" value="{{ event.id }}">
    <input type="hidden" name="status" value="going">
    <button type="submit" class="btn btn-success">Going</button>
</form>

<!-- Can Go Button -->
<form method="post" action="{% url 'update_attendance' %}" style="display:inline;">
    {% csrf_token %}
    <input type="hidden" name="event_id" value="{{ event.id }}">
    <input type="hidden" name="status" value="can_go">
    <button type="submit" class="btn btn-warning">Can Go</button>
</form>

<!-- Not Going Button -->
<form method="post" action="{% url 'update_attendance' %}" style="display:inline;">
    {% csrf_token %}
    <input type="hidden" name="event_id" value="{{ event.id }}">
    <input type="hidden" name="status" value="not_going">
    <button type="submit" class="btn btn-danger">Not Going</button>
</form>

<br>
<br>
    <!-- Edit Button for Host Only -->
    {% if user.is_authenticated and user == event.host %}
      <a href="{% url 'event_edit' event.id %}" class="btn btn-warning">Edit Event</a>
    {% endif %}

    <!-- Back Link -->
    <a href="{% url 'event_list' %}" class="btn btn-link">Back to Event List</a>
</div>
{% endblock content %}

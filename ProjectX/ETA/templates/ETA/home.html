{% extends "ETA/base.html" %}
{% load static %}

{% block title %}Welcome | uGoing{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="jumbotron text-center bg-light py-5 mb-5">
  <h1 class="display-4">Plan - Invite - Attend.</h1>
  <h4 class="lead">uGoing makes it easy to create events, invite friends, and discover what's happening around you.</h4>
  {% if user.is_authenticated %}
  <a href="{% url 'create_event' %}" class="btn btn-primary btn-lg mt-3">Create Your First Event</a>
{% else %}
  <a href="{% url 'register' %}" class="btn btn-primary btn-lg mt-3">Join Now to Create Events</a>
{% endif %}

</div>
<link rel="stylesheet" href="{% static 'css/home.css' %}">
<!-- Upcoming Events Section -->
<h2 class="mb-4">Upcoming Events</h2>
<div class="row">
  {% for item in events_with_attendance %}
    {% with event=item.event attendance=item.attendance %}
    <div class="col-md-4 mb-4">
      <div class="card h-100">
        <div class="event-image-container">
          {% if event.image %}
            <img src="{{ event.image.url }}" class="event-image" alt="{{ event.title }}">
          {% else %}
            <img src="https://via.placeholder.com/600x600?text=No+Image" class="event-image" alt="No image">
          {% endif %}
          <h5 class="event-title-overlay">{{ event.title }}</h5>
        </div>        
        <div class="card-body d-flex flex-column">
          <p class="card-text">{{ event.description|truncatewords:15 }}</p>
          <p class="text-muted">
            <small>{{ event.start_date|date:"M d, H:i" }} - {{ event.end_date|date:"M d, H:i" }}</small>
          </p>
          <div class="mt-auto">
            <a href="{% url 'event_detail' event.id %}" class="btn btn-outline-primary btn-sm">View Details</a>
          </div>
        </div>
        <div class="card-footer">
          {% if event.host == request.user %}
          <span class="badge badge-primary">Host</span>
          {% elif attendance %}
            {% if attendance.status == "going" %}
              <span class="badge badge-success">Going</span>
            {% elif attendance.status == "can go" %}
              <span class="badge badge-warning">Can Go</span>
            {% elif attendance.status == "not going" %}
              <span class="badge badge-danger">Not Going</span>
            {% endif %}
          {% else %}
            <span class="badge badge-secondary">No Response</span>
          {% endif %}

          {% if event.is_public %}
            <span class="badge badge-success">Public</span>
          {% else %}
            <span class="badge badge-secondary">Private</span>
          {% endif %}
          
        </div>
      </div>
    </div>
    {% endwith %}
  {% empty %}
    <div class="col-12">
      <p class="text-muted">No upcoming events to show.</p>
    </div>
  {% endfor %}
</div>
{% endblock %}
